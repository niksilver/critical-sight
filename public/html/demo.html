<html>
<head>
<meta charset="utf-8">
<title>Critical Sight Gantt chart</title>

<!-- Get the graphics library from local lib -->
<script	src="/public/lib/easeljs-0.8.0.min.js"></script>

<!-- Get the jQuery from CDN. Required for ready() function. -->
<script src="http://code.jquery.com/jquery-2.1.3.js"></script>

<style>
#chart {
	display: flex;
	flex-direction: row;
	height: 200px;
	margin-bottom: 20px;
}

#chart-text {
	width: 20%;
	overflow: hidden;
}

#chart-bars {
	overflow: auto;
	height: 200px;
}
</style>

</head>
<body>

<div id="chart">
	<div id="chart-text">
		<table id="chart-text-inner">
		<tr><td>t0</td><td>Line one</td></tr>
		<tr><td>t1</td><td>Line two</td></tr>
		<tr><td>b1</td><td>Feeder buffer</td></tr>
		<tr><td>t2</td><td>Long line three</td></tr>
		<tr><td>tEnd</td><td>Line four-ish</td></tr>
		<tr><td>t4</td><td>Line five or so</td></tr>
		<tr><td>b1</td><td>Feeder buffer</td></tr>
		<tr><td>b2</td><td>Completion buffer</td></tr>
		</table>
	</div>
	<div id="chart-bars">
		<canvas id="chart-bars-canvas"></canvas>
	</div>
</div>

<form action="#" method="POST">
<textarea id="plantext" name="text" rows="10" cols="60"></textarea>
<span id="submit-plan">Go....!</span>
</form>

</body>

<!-- Our own code -->
<script src="/public/javascripts/CriticalSight.js"></script>
<script src="/public/javascripts/Sizer.js"></script>
<script src="/public/javascripts/DependencyMaker.js"></script>
<script src="/public/javascripts/PeriodMaker.js"></script>
<script src="/public/javascripts/Plan.js"></script>
<script src="/public/javascripts/Chart.js"></script>

<script>
	var CS = CriticalSight;
	
	var defaultPlan =
	    't0: "Start"\n' +
	    't1: "Write a long list" 2.0\n' +
	    't2: "Do what\'s on the list" 5.0\n' +
	    'tEnd: "End"\n' +
	    't4: "Extra work" 2.0\n' +
	    't0 -> t1 -> tEnd\n' +
	    't0 -> t2 -> tEnd\n' +
	    't0 -> t4 -> t1\n' +
	    't4 -> tEnd\n';
	
	// Do this when the page has loaded
	
	$(function() {

		var htmlCanvas = document.getElementById('chart-bars-canvas');
		htmlCanvas.width = 1000;
		htmlCanvas.height = 500;

		var stage = new createjs.Stage(htmlCanvas);

		// Lay out the chart text (testing only)
		$("tr").each(function() {
		    $(this).css("height", "20px");
		    //$(this).css("margin-top", "10px");
		    //$(this).css("margin-bottom", "0px");
		});
		
		// Insert and render the default plan (chart bars)
		
		$("#plantext").val(defaultPlan);
		CS.Chart.showBarsByText(stage, defaultPlan);
		
		// Update the rendering when we change the text
		
		$("#submit-plan").click(function() {
		    var text = $("#plantext").val();
		    CS.Chart.showBarsByText(stage, text);
		});
		
		// Respond to the bars div scrolling
		
		$("#chart-bars").scroll(function(data) {
		    var top = $("#chart-bars").scrollTop();
		    var marginTop = ""+(-1 * top)+"px";
		    $("#chart-text-inner").css("margin-top", marginTop);
		});
	});
</script>
</html>
