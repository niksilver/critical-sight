<html>
<head>
<meta charset="utf-8">
<title>Critical Sight Gantt chart</title>

<!-- Get the graphics library from local lib -->
<script	src="/public/lib/easeljs-0.8.0.min.js"></script>

<!-- Get the jQuery from CDN. Required for ready() function. -->
<script src="http://code.jquery.com/jquery-2.1.3.js"></script>

<style>
#chart {
	display: flex;
	flex-direction: row;
	height: 200px;
	margin-bottom: 20px;
}

#chart-text {
	width: 20%;
	overflow: hidden;
}

#chart-text-inner {
	margin-top: -27px;
}

#chart-bars {
	overflow: auto;
	height: 200px;
}
</style>

</head>
<body>

<div id="chart">
	<div id="chart-text">
		<div id="chart-text-inner">
			CSS is one of the core languages of the open web and has a standardized W3C specification. Developed in levels, CSS1 is now obsolete, CSS2.1 is a recommendation, and CSS3, now split into smaller modules, is progressing on the standardization track.
			Gecko's support of flexible boxes has been adapted to match a recent specification clarification: from Firefox 23 ::before and ::after will be flex items, and as such can be repositioned using order and align-self. (May 3rd, 2013)
		</div>
	</div>
	<div id="chart-bars">
		<canvas id="chart-bars-canvas" style="border: 1px solid black;"></canvas>
	</div>
</div>

<form action="#" method="POST">
<textarea id="plantext" name="text" rows="10" cols="60"></textarea>
<span id="submit-plan">Go!</span>
</form>

</body>

<!-- Our own code -->
<script src="/public/javascripts/CriticalSight.js"></script>
<script src="/public/javascripts/Sizer.js"></script>
<script src="/public/javascripts/DependencyMaker.js"></script>
<script src="/public/javascripts/PeriodMaker.js"></script>
<script src="/public/javascripts/Plan.js"></script>
<script src="/public/javascripts/Chart.js"></script>

<script>
	var CS = CriticalSight;
	
	var defaultPlan =
	    't0: "Start"\n' +
	    't1: "Write a long list" 2.0\n' +
	    't2: "Do what\'s on the list" 5.0\n' +
	    'tEnd: "End"\n' +
	    't4: "Extra work" 2.0\n' +
	    't0 -> t1 -> tEnd\n' +
	    't0 -> t2 -> tEnd\n' +
	    't0 -> t4 -> t1\n' +
	    't4 -> tEnd\n';
	
	$("#plantext").val(defaultPlan);
	
	$(function() {

		var htmlCanvas = document.getElementById('chart-bars-canvas');
		htmlCanvas.width = 1000;
		htmlCanvas.height = 500;

		var stage = new createjs.Stage(htmlCanvas);

		var uri = '/readPlan';
		CS.Chart.showByText(stage, defaultPlan);

		$("#submit-plan").click(function() {
		    stage.removeAllChildren();
		    stage.update();
		    var text = $("#plantext").val();
		    CS.Chart.showByText(stage, text);
		});
		
		// Respond to the bars div scrolling
		$("#chart-bars").scroll(function(data) {
		    var top = $("#chart-bars").scrollTop();
		    var marginTop = ""+(-1 * top)+"px";
		    $("#chart-text-inner").css("margin-top", marginTop);
		});
	});
</script>
</html>
